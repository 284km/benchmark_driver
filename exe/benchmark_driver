#!/usr/bin/env ruby
$:.unshift File.expand_path('../lib', __dir__)

require 'benchmark_driver'
require 'optparse'
require 'yaml'

options = {}
args = OptionParser.new do |o|
  o.banner = "Usage: #{File.basename($0, '.*')} [options] [YAML]"
  o.on('-d', '--duration [SECONDS]', 'Duration seconds to run benchmark (default: 5)') do |n|
    options[:duration] = n.to_i
  end
end.parse!(ARGV)
abort "No YAML file is specified" if args.empty?

driver = BenchmarkDriver.new(options)
args.each do |yaml|
  benchmarks = YAML.load(File.read(yaml))
  if benchmarks.is_a?(Hash)
    benchmarks[:name] = File.basename(yaml, '.*')
  end
  driver.run(benchmarks)
end
